package main

/*

go run cmd/overzoom/main.go -zoom 18 16/10488/25336
2019/06/05 16:56:54 TILE &{18 41952 101344} &[-122.3876953125 37.75225820732334 -122.38632202148438 37.75334401310657]
2019/06/05 16:56:54 TILE &{18 41952 101345} &[-122.3876953125 37.75117238560618 -122.38632202148438 37.75225820732334]
2019/06/05 16:56:54 TILE &{18 41952 101346} &[-122.3876953125 37.75008654795525 -122.38632202148438 37.75117238560618]
2019/06/05 16:56:54 TILE &{18 41952 101347} &[-122.3876953125 37.74900069437069 -122.38632202148438 37.75008654795525]
2019/06/05 16:56:54 TILE &{18 41953 101344} &[-122.38632202148438 37.75225820732334 -122.38494873046875 37.75334401310657]
2019/06/05 16:56:54 TILE &{18 41953 101345} &[-122.38632202148438 37.75117238560618 -122.38494873046875 37.75225820732334]
2019/06/05 16:56:54 TILE &{18 41953 101346} &[-122.38632202148438 37.75008654795525 -122.38494873046875 37.75117238560618]
2019/06/05 16:56:54 TILE &{18 41953 101347} &[-122.38632202148438 37.74900069437069 -122.38494873046875 37.75008654795525]
2019/06/05 16:56:54 TILE &{18 41954 101344} &[-122.38494873046875 37.75225820732334 -122.38357543945312 37.75334401310657]
2019/06/05 16:56:54 TILE &{18 41954 101345} &[-122.38494873046875 37.75117238560618 -122.38357543945312 37.75225820732334]
2019/06/05 16:56:54 TILE &{18 41954 101346} &[-122.38494873046875 37.75008654795525 -122.38357543945312 37.75117238560618]
2019/06/05 16:56:54 TILE &{18 41954 101347} &[-122.38494873046875 37.74900069437069 -122.38357543945312 37.75008654795525]
2019/06/05 16:56:54 TILE &{18 41955 101344} &[-122.38357543945312 37.75225820732334 -122.3822021484375 37.75334401310657]
2019/06/05 16:56:54 TILE &{18 41955 101345} &[-122.38357543945312 37.75117238560618 -122.3822021484375 37.75225820732334]
2019/06/05 16:56:54 TILE &{18 41955 101346} &[-122.38357543945312 37.75008654795525 -122.3822021484375 37.75117238560618]
2019/06/05 16:56:54 TILE &{18 41955 101347} &[-122.38357543945312 37.74900069437069 -122.3822021484375 37.75008654795525]

> go run cmd/overzoom/main.go -zoom 15 16/10488/25336
2019/06/05 16:57:04 TILE &{15 5244 12668} &[-122.3876953125 37.74465712069939 -122.376708984375 37.75334401310657]

*/

import (
	"flag"
	"github.com/go-spatial/geom/slippy"
	"log"
	"strconv"
	"strings"
)

func main() {

	// zoom := flag.Int("zoom", 0, "...")

	flag.Parse()

	/*
		t_func := func(t *slippy.Tile) error {
			log.Println("TILE", t, t.Extent4326())
			return nil
		}
	*/

	for _, str_zxy := range flag.Args() {

		zxy := strings.Split(str_zxy, "/")

		if len(zxy) != 3 {
			log.Fatal("Invalid ZXY")
		}

		z, err := strconv.Atoi(zxy[0])

		if err != nil {
			log.Fatal(err)
		}

		x, err := strconv.Atoi(zxy[1])

		if err != nil {
			log.Fatal(err)
		}

		y, err := strconv.Atoi(zxy[2])

		if err != nil {
			log.Fatal(err)
		}

		uz := uint(z)
		ux := uint(x)
		uy := uint(y)

		// t := slippy.NewTile(uint(z), uint(x), uint(y))
		// t.RangeFamilyAt(uint(*zoom), t_func)

		var t *slippy.Tile

		if uz > uint(16) {
			mag := uz - uint(16)
			t = slippy.NewTile(uint(16), ux>>mag, uy>>mag)

		} else {
			t = slippy.NewTile(uz, ux, uy)
		}

		log.Println(t)
	}
}
